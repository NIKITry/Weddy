<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weddy RSVP - –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
</head>
<body class="bg-gradient-to-br from-pink-50 to-purple-50 min-h-screen">
    <div class="container mx-auto px-4 py-8" x-data="adminApp()" x-init="init()">
        <!-- Admin Key Input -->
        <div x-show="!adminKey" class="bg-white rounded-lg shadow-lg p-8 max-w-md mx-auto">
            <h1 class="text-3xl font-bold text-center mb-6 text-purple-600">üîê –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</h1>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        API –∫–ª—é—á
                    </label>
                    <input 
                        x-model="adminKeyInput"
                        @keyup.enter="setAdminKey()"
                        type="password" 
                        placeholder="–í–≤–µ–¥–∏—Ç–µ API –∫–ª—é—á"
                        class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-pink-500">
                </div>
                <div class="flex items-center">
                    <input 
                        x-model="rememberMe"
                        type="checkbox" 
                        id="rememberMe"
                        class="h-4 w-4 text-purple-600 focus:ring-purple-500 border-gray-300 rounded">
                    <label for="rememberMe" class="ml-2 block text-sm text-gray-700">
                        –ó–∞–ø–æ–º–Ω–∏—Ç—å –º–µ–Ω—è (–¥–æ –∑–∞–∫—Ä—ã—Ç–∏—è –±—Ä–∞—É–∑–µ—Ä–∞)
                    </label>
                </div>
                <button 
                    @click="setAdminKey()"
                    class="w-full bg-purple-500 hover:bg-purple-600 text-white px-6 py-3 rounded-lg font-semibold">
                    –í–æ–π—Ç–∏
                </button>
            </div>
        </div>

        <!-- Main Content -->
        <div x-show="adminKey">
            <!-- Logout Button -->
            <div class="mb-4 flex justify-end">
                <button 
                    @click="logout()"
                    class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg text-sm">
                    üö™ –í—ã–π—Ç–∏
                </button>
            </div>

            <!-- Header -->
            <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
                <h1 class="text-3xl font-bold text-gray-800 mb-2">üíç Weddy RSVP</h1>
                <p class="text-gray-600">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–≤–∞–¥–µ–±–Ω—ã–º–∏ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è–º–∏</p>
            </div>

            <!-- Event Settings -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <h2 class="text-2xl font-semibold mb-4">üìù –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ–±—ã—Ç–∏—è</h2>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        –¢–µ–∫—Å—Ç –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è
                    </label>
                    <textarea 
                        x-model="eventText" 
                        class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent"
                        rows="6"
                        placeholder="–í–≤–µ–¥–∏—Ç–µ –æ–±—â–∏–π —Ç–µ–∫—Å—Ç –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–π —É–≤–∏–¥—è—Ç –≤—Å–µ –≥–æ—Å—Ç–∏..."></textarea>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        –î–∞—Ç–∞ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è
                    </label>
                    <input 
                        x-model="eventDate"
                        type="date"
                        class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-pink-500">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        –ò–º–µ–Ω–∞ –ø–∞—Ä—ã –¥–ª—è —Å—Å—ã–ª–æ–∫ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
                    </label>
                    <input 
                        x-model="coupleNamesForToken"
                        type="text"
                        placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: nikita violetta –∏–ª–∏ nikita-violetta"
                        class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent">
                    <p class="text-xs text-gray-500 mt-1">–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫—Ä–∞—Å–∏–≤—ã—Ö —Å—Å—ã–ª–æ–∫ –≤–∏–¥–∞: nikita-violetta-xxxxx</p>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        –ò–º–µ–Ω–∞ –ø–∞—Ä—ã –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
                    </label>
                    <input 
                        x-model="coupleDisplayName"
                        type="text"
                        placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ù–∏–∫–∏—Ç–∞ –∏ –í–∏–æ–ª–µ—Ç—Ç–∞"
                        class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent">
                    <p class="text-xs text-gray-500 mt-1">–û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–µ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è –∫–∞–∫ "–í–∞—à–∏ [–∏–º–µ–Ω–∞]" –∫—Ä–∞—Å–∏–≤—ã–º —à—Ä–∏—Ñ—Ç–æ–º</p>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        –ü–ª–∞–Ω –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
                    </label>
                    <div class="space-y-3">
                        <template x-for="(item, index) in eventPlanItems" :key="index">
                            <div class="flex gap-2 items-start p-3 border rounded-lg bg-gray-50">
                                <div class="flex-1 grid grid-cols-3 gap-2">
                                    <input 
                                        x-model="eventPlanItems[index].time"
                                        type="text" 
                                        placeholder="16:00"
                                        class="p-2 border rounded text-sm"
                                        style="max-width: 100px;">
                                    <input 
                                        x-model="eventPlanItems[index].title"
                                        type="text" 
                                        placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è"
                                        class="p-2 border rounded text-sm">
                                    <input 
                                        x-model="eventPlanItems[index].location"
                                        type="text" 
                                        placeholder="–ú–µ—Å—Ç–æ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è"
                                        class="p-2 border rounded text-sm">
                                </div>
                                <button 
                                    @click="eventPlanItems.splice(index, 1)"
                                    type="button"
                                    class="text-red-500 hover:text-red-700 px-2">
                                    ‚úï
                                </button>
                            </div>
                        </template>
                        <button 
                            @click="eventPlanItems.push({ time: '', title: '', location: '' })"
                            type="button"
                            class="w-full bg-gray-100 hover:bg-gray-200 text-gray-700 px-4 py-2 rounded-lg text-sm">
                            + –î–æ–±–∞–≤–∏—Ç—å –ø—É–Ω–∫—Ç
                        </button>
                    </div>
                    <p class="text-xs text-gray-500 mt-2">–î–æ–±–∞–≤—å—Ç–µ –ø—É–Ω–∫—Ç—ã –ø–ª–∞–Ω–∞ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è —Å –≤—Ä–µ–º–µ–Ω–µ–º, –Ω–∞–∑–≤–∞–Ω–∏–µ–º –∏ –º–µ—Å—Ç–æ–º</p>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ –≤–Ω–∏–∑—É –∫–∞—Ä—Ç–æ—á–∫–∏
                    </label>
                    <textarea 
                        x-model="footerNote" 
                        class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent"
                        rows="4"
                        placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –ø—Ä–∏–º–µ—á–∞–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –≤–Ω–∏–∑—É –∫–∞—Ä—Ç–æ—á–∫–∏ –ø–æ—Å–ª–µ –æ—Ç–≤–µ—Ç–∞ RSVP..."></textarea>
                    <p class="text-xs text-gray-500 mt-1">–¢–µ–∫—Å—Ç –±—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –≤–Ω–∏–∑—É –∫–∞—Ä—Ç–æ—á–∫–∏ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è –ø–æ—Å–ª–µ —Å–µ–∫—Ü–∏–∏ RSVP</p>
                </div>
            </div>
            <button 
                @click="saveEventText()"
                :disabled="saving"
                class="mt-4 bg-pink-500 hover:bg-pink-600 text-white px-6 py-2 rounded-lg font-semibold disabled:opacity-50">
                <span x-show="!saving">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</span>
                <span x-show="saving">‚è≥ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...</span>
            </button>
            <div x-show="eventMessage" x-text="eventMessage" 
                 :class="eventSuccess ? 'text-green-600' : 'text-red-600'"
                 class="mt-2"></div>
        </div>

        <!-- Create Invitation -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <h2 class="text-2xl font-semibold mb-4">‚ûï –°–æ–∑–¥–∞—Ç—å –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ</h2>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        –ò–º–µ–Ω–∞ –ø—Ä–∏–≥–ª–∞—à–∞–µ–º—ã—Ö *
                    </label>
                    <input 
                        x-model="newInvitationName"
                        @keyup.enter="createInvitation()"
                        type="text" 
                        placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ò–≤–∞–Ω –∏ –ú–∞—Ä–∏—è"
                        class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-pink-500">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        –ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π —Ç–µ–∫—Å—Ç –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
                    </label>
                    <textarea 
                        x-model="newInvitationText"
                        class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-pink-500"
                        rows="3"
                        placeholder="–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–æ–µ –æ–±—Ä–∞—â–µ–Ω–∏–µ –∫ –≥–æ—Å—Ç—è–º"></textarea>
                    <p class="text-xs text-gray-500 mt-1">–ï—Å–ª–∏ –æ—Å—Ç–∞–≤–∏—Ç—å –ø—É—Å—Ç—ã–º, –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –æ–±—â–∏–π —Ç–µ–∫—Å—Ç –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è</p>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        –ú–µ—Ç–∞-–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∞, –Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
                    </label>
                    <input 
                        x-model="newInvitationMetaNote"
                        type="text" 
                        placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –†–æ–¥—Å—Ç–≤–µ–Ω–Ω–∏–∫–∏ —Å–æ —Å—Ç–æ—Ä–æ–Ω—ã –Ω–µ–≤–µ—Å—Ç—ã"
                        class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-pink-500">
                    <p class="text-xs text-gray-500 mt-1">–ü–æ–º–æ–≥–∞–µ—Ç –ø–æ–Ω—è—Ç—å, –∫–æ–º—É –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ. –í–∏–¥–Ω–æ —Ç–æ–ª—å–∫–æ –≤ –∞–¥–º–∏–Ω–∫–µ</p>
                </div>
                <button 
                    @click="createInvitation()"
                    :disabled="creating"
                    class="w-full bg-purple-500 hover:bg-purple-600 text-white px-6 py-2 rounded-lg font-semibold disabled:opacity-50">
                    <span x-show="!creating">‚ú® –°–æ–∑–¥–∞—Ç—å –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ</span>
                    <span x-show="creating">‚è≥ –°–æ–∑–¥–∞–Ω–∏–µ...</span>
                </button>
            </div>
        </div>

        <!-- Invitations List -->
        <div class="bg-white rounded-lg shadow-lg p-6">
            <div class="flex justify-between items-center mb-4">
                <div>
                    <h2 class="text-2xl font-semibold">üìã –°–ø–∏—Å–æ–∫ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–π</h2>
                    <p class="text-sm text-gray-600 mt-1" x-show="!loading">
                        –í—Å–µ–≥–æ: <span class="font-semibold" x-text="totalCount"></span> –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–π
                    </p>
                </div>
                <div class="flex gap-2">
                    <input 
                        x-model="searchQuery"
                        @input="loadInvitations()"
                        type="text" 
                        placeholder="–ü–æ–∏—Å–∫..."
                        class="p-2 border rounded-lg focus:ring-2 focus:ring-pink-500">
                    <select 
                        x-model="statusFilter"
                        @change="loadInvitations()"
                        class="p-2 border rounded-lg focus:ring-2 focus:ring-pink-500">
                        <option value="">–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã</option>
                        <option value="none">–ù–µ—Ç –æ—Ç–≤–µ—Ç–∞</option>
                        <option value="yes">–ü—Ä–∏–¥—É—Ç</option>
                        <option value="no">–ù–µ –ø—Ä–∏–¥—É—Ç</option>
                    </select>
                </div>
            </div>

            <div x-show="loading" class="text-center py-8">
                <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-pink-500"></div>
            </div>

            <div x-show="!loading && invitations.length === 0" class="text-center py-8 text-gray-500">
                –ù–µ—Ç –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–π
            </div>

            <div class="space-y-4">
                <template x-for="inv in invitations" :key="inv.id">
                    <div class="border rounded-lg p-4 hover:shadow-md transition-shadow">
                        <div class="flex justify-between items-start">
                            <div class="flex-1">
                                <h3 class="font-semibold text-lg" x-text="inv.displayName"></h3>
                                <div class="mt-2 space-y-1">
                                    <div class="flex items-center gap-2">
                                        <span class="text-sm text-gray-600">–°—Ç–∞—Ç—É—Å:</span>
                                        <span 
                                            :class="{
                                                'bg-yellow-100 text-yellow-800': inv.status === 'none',
                                                'bg-green-100 text-green-800': inv.status === 'yes',
                                                'bg-red-100 text-red-800': inv.status === 'no'
                                            }"
                                            class="px-2 py-1 rounded text-sm font-semibold"
                                            x-text="getStatusText(inv.status)"></span>
                                    </div>
                                    <div x-show="inv.invitationText && inv.invitationText.trim()" class="mt-2 p-3 bg-purple-50 rounded-lg border border-purple-200">
                                        <div class="text-xs text-purple-600 font-semibold mb-1">‚úâÔ∏è –ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π —Ç–µ–∫—Å—Ç –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è:</div>
                                        <div class="text-sm text-gray-700 whitespace-pre-line" x-text="inv.invitationText"></div>
                                    </div>
                                    <div x-show="inv.note" class="text-sm text-gray-600 mt-2">
                                        <span class="font-semibold">–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ –æ—Ç –≥–æ—Å—Ç—è:</span> <span x-text="inv.note"></span>
                                    </div>
                                    <div x-show="inv.metaNote && inv.metaNote.trim()" class="text-sm text-gray-500 mt-2 italic">
                                        <span class="font-semibold">üìù –ú–µ—Ç–∞-–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:</span> <span x-text="inv.metaNote"></span>
                                    </div>
                                    <div class="text-xs text-gray-400 mt-2">
                                        <a :href="baseUrl + '/i/' + inv.token" target="_blank" 
                                           class="text-pink-500 hover:underline break-all" 
                                           x-text="baseUrl + '/i/' + inv.token"></a>
                                    </div>
                                </div>
                            </div>
                            <div class="flex gap-2 ml-4">
                                <button 
                                    @click="copyLink(inv.token)"
                                    class="bg-gray-100 hover:bg-gray-200 px-3 py-1 rounded text-sm">
                                    üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É
                                </button>
                                <button 
                                    @click="toggleArchive(inv)"
                                    :class="inv.archived ? 'bg-green-500 hover:bg-green-600' : 'bg-orange-500 hover:bg-orange-600'"
                                    class="text-white px-3 py-1 rounded text-sm">
                                    <span x-show="!inv.archived">üì¶ –ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞—Ç—å</span>
                                    <span x-show="inv.archived">üì§ –†–∞–∑–∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞—Ç—å</span>
                                </button>
                                <button 
                                    @click="deleteInvitation(inv)"
                                    class="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-sm">
                                    üóëÔ∏è –£–¥–∞–ª–∏—Ç—å
                                </button>
                            </div>
                        </div>
                    </div>
                </template>
            </div>
            </div>
        </div>
        </div>
    </div>

    <script>
        function adminApp() {
            return {
                eventText: '',
                eventDate: '',
                eventPlanItems: [],
                footerNote: '',
                coupleNamesForToken: '',
                coupleDisplayName: '',
                newInvitationName: '',
                newInvitationText: '',
                newInvitationMetaNote: '',
                invitations: [],
                loading: false,
                saving: false,
                creating: false,
                searchQuery: '',
                statusFilter: '',
                totalCount: 0,
                eventMessage: '',
                eventSuccess: false,
                baseUrl: '{{INVITATION_BASE_URL}}',
                apiBaseUrl: '{{API_BASE_URL}}',
                adminKey: '',
                adminKeyInput: '',
                rememberMe: false,

                init() {
                    // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π –∫–ª—é—á –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
                    const savedKey = sessionStorage.getItem('weddy_admin_key') || localStorage.getItem('weddy_admin_key');
                    if (savedKey) {
                        this.adminKey = savedKey;
                        this.loadEventText();
                        this.loadInvitations();
                    }
                },

                setAdminKey() {
                    if (!this.adminKeyInput.trim()) {
                        alert('–í–≤–µ–¥–∏—Ç–µ API –∫–ª—é—á');
                        return;
                    }
                    this.adminKey = this.adminKeyInput.trim();
                    
                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∫–ª—é—á –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤—ã–±–æ—Ä–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                    if (this.rememberMe) {
                        localStorage.setItem('weddy_admin_key', this.adminKey);
                        sessionStorage.removeItem('weddy_admin_key'); // –û—á–∏—â–∞–µ–º sessionStorage –µ—Å–ª–∏ –≤—ã–±—Ä–∞–ª–∏ localStorage
                    } else {
                        sessionStorage.setItem('weddy_admin_key', this.adminKey);
                        localStorage.removeItem('weddy_admin_key'); // –û—á–∏—â–∞–µ–º localStorage –µ—Å–ª–∏ –≤—ã–±—Ä–∞–ª–∏ sessionStorage
                    }
                    
                    this.adminKeyInput = '';
                    this.loadEventText();
                    this.loadInvitations();
                },

                logout() {
                    this.adminKey = '';
                    sessionStorage.removeItem('weddy_admin_key');
                    localStorage.removeItem('weddy_admin_key');
                    this.invitations = [];
                    this.eventText = '';
                },

                async loadEventText() {
                    try {
                        const response = await fetch(`${this.apiBaseUrl}/admin/event`, {
                            headers: { 'X-Admin-Key': this.adminKey }
                        });
                        const data = await response.json();
                        this.eventText = data.invitation_text || '';
                        this.eventDate = data.event_date ? data.event_date.split('T')[0] : '';
                        this.eventPlanItems = data.event_plan && Array.isArray(data.event_plan) ? data.event_plan : [];
                        this.footerNote = data.footer_note || data.footerNote || '';
                        this.coupleNamesForToken = data.couple_names_for_token || '';
                        this.coupleDisplayName = data.couple_display_name || '';
                    } catch (error) {
                        console.error('Error loading event text:', error);
                    }
                },

                async saveEventText() {
                    this.saving = true;
                    this.eventMessage = '';
                    try {
                        const eventPlan = this.eventPlanItems && this.eventPlanItems.length > 0
                            ? this.eventPlanItems.filter(item => item.time || item.title || item.location)
                            : null;

                        const response = await fetch(`${this.apiBaseUrl}/admin/event`, {
                            method: 'PUT',
                            headers: {
                                'Content-Type': 'application/json',
                                'X-Admin-Key': this.adminKey
                            },
                            body: JSON.stringify({
                                invitationText: this.eventText,
                                eventDate: this.eventDate || null,
                                eventPlan: eventPlan && eventPlan.length > 0 ? eventPlan : null,
                                footerNote: this.footerNote || '',
                                coupleNamesForToken: this.coupleNamesForToken || '',
                                coupleDisplayName: this.coupleDisplayName || ''
                            })
                        });
                        if (response.ok) {
                            this.eventSuccess = true;
                            this.eventMessage = '‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!';
                            setTimeout(() => this.eventMessage = '', 3000);
                        } else {
                            throw new Error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è');
                        }
                    } catch (error) {
                        this.eventSuccess = false;
                        this.eventMessage = '‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è';
                    } finally {
                        this.saving = false;
                    }
                },

                async createInvitation() {
                    if (!this.newInvitationName.trim()) {
                        alert('–í–≤–µ–¥–∏—Ç–µ –∏–º—è –≥–æ—Å—Ç—è!');
                        return;
                    }
                    this.creating = true;
                    try {
                        const requestBody = {
                            displayName: this.newInvitationName,
                            invitationText: this.newInvitationText?.trim() || null,
                            metaNote: this.newInvitationMetaNote?.trim() || null
                        };
                        const response = await fetch(`${this.apiBaseUrl}/admin/invitations`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'X-Admin-Key': this.adminKey
                            },
                            body: JSON.stringify(requestBody)
                        });
                        if (response.ok) {
                            this.newInvitationName = '';
                            this.newInvitationText = '';
                            this.newInvitationMetaNote = '';
                            await this.loadInvitations();
                        } else {
                            throw new Error('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è');
                        }
                    } catch (error) {
                        alert('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è');
                    } finally {
                        this.creating = false;
                    }
                },

                async loadInvitations() {
                    this.loading = true;
                    try {
                        const params = new URLSearchParams();
                        if (this.statusFilter) params.append('status', this.statusFilter);
                        if (this.searchQuery) params.append('query', this.searchQuery);
                        params.append('archived', 'false');

                        const response = await fetch(`${this.apiBaseUrl}/admin/invitations?${params}`, {
                            headers: { 'X-Admin-Key': this.adminKey }
                        });
                        const data = await response.json();
                        this.invitations = data.items || [];
                        this.totalCount = data.total || 0;
                    } catch (error) {
                        console.error('Error loading invitations:', error);
                    } finally {
                        this.loading = false;
                    }
                },

                async toggleArchive(inv) {
                    try {
                        const response = await fetch(`${this.apiBaseUrl}/admin/invitations/${inv.id}`, {
                            method: 'PATCH',
                            headers: {
                                'Content-Type': 'application/json',
                                'X-Admin-Key': this.adminKey
                            },
                            body: JSON.stringify({ archived: !inv.archived })
                        });
                        if (response.ok) {
                            await this.loadInvitations();
                        }
                    } catch (error) {
                        alert('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è');
                    }
                },

                copyLink(token) {
                    const link = `${this.baseUrl}/i/${token}`;
                    navigator.clipboard.writeText(link).then(() => {
                        alert('–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞!');
                    });
                },

                async deleteInvitation(inv) {
                    if (!confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –¥–ª—è "${inv.displayName}"? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.`)) {
                        return;
                    }
                    try {
                        const response = await fetch(`${this.apiBaseUrl}/admin/invitations/${inv.id}`, {
                            method: 'DELETE',
                            headers: {
                                'X-Admin-Key': this.adminKey
                            }
                        });
                        if (response.ok || response.status === 204) {
                            await this.loadInvitations();
                        } else {
                            const errorText = await response.text();
                            console.error('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è:', response.status, errorText);
                            throw new Error(`–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è: ${response.status}`);
                        }
                    } catch (error) {
                        console.error('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è:', error);
                        alert(`–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è: ${error.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}`);
                    }
                },

                getStatusText(status) {
                    const statuses = {
                        'none': '‚è≥ –ù–µ—Ç –æ—Ç–≤–µ—Ç–∞',
                        'yes': '‚úÖ –ü—Ä–∏–¥—É—Ç',
                        'no': '‚ùå –ù–µ –ø—Ä–∏–¥—É—Ç'
                    };
                    return statuses[status] || status;
                }
            }
        }
    </script>
</body>
</html>

